# 数据链路层

## 三个重要问题
- 封装成帧：添加帧头和帧尾
  - 帧头信息：
    - 目的地址： 6字节
    - 源地址：   6字节
    - 类型：     2字节
  - 帧尾信息：
    - 检错码：   4字节
- 差错检测
- 可靠传输：发送方发送什么，接收方都能收到

## 封装成帧
- 添加帧头和帧尾
- 帧定界
- 透明传输：对上层交付的传输数据没有限制，如果传输数据中包含帧定界符，插入转义字符或比特填充
- 提高帧的传输效率，增大帧的数据部分

## 差错检测 
- FCS ->检错码
- 奇偶校验 漏检率较高
- 循环冗余校验CRC：双方约定好一个生成多项式，基于生成多项式计算差错检测码，将其添加到传输数据后一起传输，接收方通过生成多项式计算是否产生误码（余数是否为0）
  
## 可靠传输

- 停止等待协议： 超时计时器->超时重传    数据和确认信号增加序号->防止重复确认   信道利用率较低
- 回退N帧协议
- 选择重传协议


## 点对点协议 PPP
- 对各种协议数据报的封装方法
- 链路控制协议LCP
- 一套网络控制协议NCPs
- 提供不可靠传输服务
  格式：
  F A C P 帧的数据部分 FCS F
  - F：标志字段，1字节，定界符，取值为0x7E
  - A: 地址字段，1字节，取值为0xFF，预留（目前没什么作用）
  - C：控制字段，1字节，取值为0x03，预留（目前没什么作用）
  - P: 协议字段，2字节，指明帧的数据部分送交哪个协议处理
    - 取值为0x0021：IP数据报
    - 取值为0xC021：LCP分组
    - 取值为0x8021：NCP分组
  - FCS: 帧检验序列字段，2字节，CRC计算出的额校验位
  透明传输：
    - 面向字节的异步链路：字节填充法
    - 面向比特的同步链路：比特填充法

协议流程：
![](pitcures/ppp协议流程.png)

## 媒体接入控制
- 静态划分信道： 预先分配好信道，不灵活，对于突发性数据传输信道利用率较低，通常在无线网络的物理层中使用，而不是数据链路层。
  - 频分多址
  - 时分多址
  - 码分多址
- 动态接入控制
  - 受控接入： 已被淘汰
    - 集中控制：主站进行轮询，被轮询到的站点才能发送数据，存在单点故障问题
    - 分散控制：各站点平等的形成一个环形网络，令牌沿着环传递，接收到令牌的站点才可以发送数据（IEEE 802.5令牌环网，IEEE 802.4令牌总线网）
  - 随机接入：各站点通过竞争随机的在信道上发送数据，关键问题是如何尽量避免冲突和冲突后尽快回复通信（共享式以太网）
  

### CSMA/CD 载波监听多址接入/碰撞检测
- 多址接入MA：多个站连接到一条总线上，竞争使用总线
- 载波监听CS：每一个站在发送帧之前都先要检测一下总线上是否有其他站点在发送帧，若总线空闲96比特时间，则开始发送，若总线忙，则继续检测并等待空闲96比特时间
- 碰撞检测CD：每一个正在发送帧的站边发送边检测，一旦发现碰撞，立即停止发送，退避一段随机事件后再次发送

- 争用期：以太网单程端到端传播时延为t，则主机最多经过2t就可以检测出是否发生了碰撞，2t称为争用期货碰撞窗口，主机越多，发生碰撞的概率就越大，所以共享式以太网不能连接太多的主机
- 最小帧长： 最小帧长为64字节，即512比特，保证主机能检测出碰撞
- 最大帧长：1528字节，防止长时间占用总线和缓冲区溢出

- 截断二进制指数退避算法
发送方流程
![](pitcures/csmacd发送方.png)
接收方流程
![](pitcures/csmacd接收方.png)

### CSMA/CA 载波监听多址接入/碰撞避免 （802.11无线局域网）
- 无线电波进行碰撞检测比较困难，无线信号的的强度动态范围较大
- 不可能避免所有碰撞，数据链路层还使用了确认机制（停止等待协议），保证数据被正确接收
- MAC层媒体接入方式：
  - 分布式协调功能DCF,没有中心控制站点，默认方式
  - 点协调功能PCF，集中控制的接入算法，实际中使用较少
- 帧间间隔：
  - 所有站点必须在持续监测到信道空闲一段指定时间后才能发送帧
  - 帧的类型决定帧间间隔的长短：高优先级的帧需要等待的时间较短。
  - 常用帧间间隔SIFS：
    - 短时间间隔：28微秒，分割属于一次对话的各帧
    - DCF帧间间隔：128微秒，用来发送数据帧和管理帧


## 地址

- MAC地址：也称为硬件地址和物理地址，以太网的MAC子层所使用的地址 --》数据链路层
- IP地址：TCP/IP体系结构中网际层使用的地址 --》网际层（就是网络层）
- ARP协议：通过IP地址获取设备的MAC地址  --》网际层

### IEEE 802局域网的MAC地址
- EUI-48 : 48比特 6字节 
  - 前三个字节为组织唯一标识符OUI：由IEEE的注册管理机构分配
  - 网络接口标识符：由获得OUI得厂商自行随意分配
  - 标准表示法：16进制：XX-XX-XX-XX-XX-XX
- 单播MAC地址：接受方与地址匹配才接受
- 广播MAC地址：FF-FF-FF-FF-FF-FF
- 多播MAC地址：看接收方的多播组列表中是否包含帧的多播地址
