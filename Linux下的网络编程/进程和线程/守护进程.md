### 守护进程
- 终端:
  - UNIX系统中,用户通过终端登录后得到一个shell进程,这个终端成为shell进程的控制终端,进程中,控制终端是保存在PCB中的信息,而fork()会复制PCB中的信息,因此由shell进程启动的其他进程的控制终端也是这个终端
  - 默认情况下(没有重定向), 每个进程的标准输入,输出和错误都是指向控制终端,进程从标准输入读也就是读用户的键盘输入,进程往标准输出或错误写也是输出到显示器上
  - 在控制终端可以输入特殊的控制字符给前台进程发送信号,例如ctrl+c
- 进程组:
  - 一组相关进程的集合,会话是一组相关进程组的集合.进程组会话是为支持hsell作业控制而定义的抽象概念,用户通过shell能够交互式地在前台或后台运行命令.
  - 进程组由一个或多个共性同一进程组标识符(PGID)的进程组成,一个进程组拥有一个进程组首进程,首进程是创建该组的进程,其进程ID为该组的ID,新进程会继承其父进程所属的进程组ID
  - 进程组的生命周期:开始于首进程创建组的时刻,结束于最后一个成员进程退出组的时刻(一个进程可能会因为终止而退出进程组,也可能因为加入另一个进程组而退出)
- 会话:
  - 一组*进程组的集合*,会话首进程是创建该新会话的进程,其进程ID会成为会话ID,新进程会继承其父进程的会话ID
  - 一个会话中的所有进程共享单个控制终端,控制终端会在会话首进程首次打开一个终端设备时被建立.一个终端最多可能成为一个会话的控制终端
  - 在任一时刻,会话中的其中一个进程组会成为终端的前台进程组,其他进程组会成为后台进程组,只有前台进程组的进程才能从控制终端中读取输入,当用户在控制终端输入终端字符生成信号时,该信号会被发送到前台进程组的所有成员
  - 当控制终端的连接建立起来后,会话的首进程会成为该终端的控制进程
- 函数:
  - pid_t getpgrp(void);获取当前进程组
  - pid_t getpgid(pid_t pid);获取指定进程的进程组
  - int setpgid(pid_t pid, pid_t pgid); 设置进程的进程组
  - pid_t getsid(pid_t pid);获取指定进程的会话id
  - pid_t setsid(void);设置会话的id
- 守护进程(Daemon Process),也称精灵进程,是linux中的后台服务进程,是一个生存期较长的进程,通常独立于控制终端并且周期性的执行某种任务或等待处理某些发生的事件,一般采用以d结尾的名字
  - 特点:
    - 生命周期很长:守护进程会在系统启动时创建并一直运行直到系统关闭
    - 在后台运行并且不拥有控制终端,确保可内核永远不会为守护进程自动生成任何控制信号以及终端相关信号
  - linux的大多数服务器就是用守护进程实现的,例如internet服务器inetd,web服务器httpd等.
  - 守护进程的创建步骤:
    - 执行一个fork(),之后父进程退出,子进程继续执行
    - 子进程调用setsid()开启一个新的会话(脱离原来的控制终端)
    - 清除进程的umask保证守护进程创建文件和目录是拥有所需的权限
    - 修改进程的当前工作目录,通常会改为根目录
    - 关闭守护进程从父进程继承来的所有打开的文件描述符
    - 关闭了文件描述符0,1,2之后,守护进程通常会打开/dev/null,并使用dup2()使所有描述符指向这个设备
    - 核心业务逻辑